- name: Check if rbenv-ctags is installed
  stat: path=~/.rbenv/plugins/rbenv-ctags
  register: rbenv_ctags_installed

- name: Install rbenv-ctags
  git: repo=https://github.com/tpope/rbenv-ctags.git dest=~/.rbenv/plugins/rbenv-ctags
  when: rbenv_ctags_installed.islnk is not defiled

- name: Get latest Ruby version
  shell: rbenv install -l | grep -v - | tail -1 | sed -e 's/^ *//'
  register: ruby_version

- name: Check if latest Ruby is installed
  shell: rbenv versions | grep {{ ruby_version.stdout }}
  register: ruby_is_installed
  ignore_errors: true

- name: Install latest Ruby
  command: rbenv install {{ ruby_version.stdout }}
  when: ruby_is_installed | failed

- name: Set global Ruby
  command: rbenv global {{ ruby_version.stdout }}

- name: Install bundler
  command: gem install bundler
